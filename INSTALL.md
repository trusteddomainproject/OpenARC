# OpenARC Installation

This document provides instructions on how to install OpenARC from source.

* [Developing](#development-installation)
* [Deploying](#deploy-installation)
* [Docker](#docker-support)

## Development Installation

If you want to start developing OpenARC you should know how to fully build the project.

1. Start by installing its dependencies:
```bash
# DNF package manager
dnf install -y git automake make libtool libbsd-devel sendmail-milter sendmail-devel

# YUM package manager
yum install -y git automake make libtool libbsd-devel sendmail-milter sendmail-devel

# APT package manager
apt-get install -y  git automake make libtool libbsd-dev libmilter-dev libmilter
```

2. Clone the project onto your computer and change into the clone directory
```
git clone https://github.com/trusteddomainproject/OpenARC.git OpenARC/ && cd OpenARC/
```

3. Run autoreconf to generate the configure script:
```bash
autoreconf -fvi
```

4. Execute the configure script:
```bash
./configure
```

5. Now that the Makefile has been generated, execute make:
```bash
make
```

The project is now built and you may start testing and developing, the Makefile will be useful to several actions:
* make install: Will install OpenARC on your system.
* make rpm: Will use rpmbuild and create an RPM using your system architecture and operating system details.

## Deploy Installation

In order to make it easier to install, the Makefile in the project contains a "make rpm" directive which generates an RPM useful for installing OpenARC into RPM packages based systems such as CentOS, RHEL or FEDORA.

1. Start by installing its dependencies:
```bash
# DNF package manager
dnf install -y git make automake rpm-build rpmdevtools libtool libbsd-devel openssl openssl-devel sendmail-milter sendmail-devel

# YUM package manager
yum -y install epel-release
yum install -y git make automake rpm-build rpmdevtools libtool libbsd-devel openssl openssl-devel sendmail-milter sendmail-devel
```

2. Setup the RPM-build tree:
```bash
cd /root/ ; rpmdev-setuptree
```

3. Clone the project onto your computer and change into the clone directory
```
git clone https://github.com/trusteddomainproject/OpenARC.git OpenARC/ && cd OpenARC/
```

4. Run autoreconf to generate the configure script:
```bash
autoreconf -fvi
```

5. Execute the configure script:
```bash
./configure
```

6. Now that the Makefile has been generated, execute make:
```bash
make
```

7. The project is now built and an RPM compatible with the system can be generated by the following command:
```bash
make rpm
```

The RPM will be generated in the /root/RPMS/ and the source RPMs will be at /root/SRPMS/, these can then be installed through yum, dnf or rpm.

## Docker Support

There is a Dockerfile at the repository root which deploys a CentOS7 docker running OpenARC (in SV mode) and SSHD which you may use to help in your development or even to generate the RPMs for you. The docker exposes port 22 for SSH access and 8894 to allow you to use the running OpenARC as a milter.

To create the docker, make sure your system has docker installed, your user has access to docker and that you have built the project and so have access to the Makefile:
```bash
make docker domain=example.com selector=example.com keyfile=./example.com.private
```

This command will take a domain, selector and a private key file which are used to configure OpenARC. If the domain you provided has a TXT record which matches the given private key and selector your the signature provided by OpenARC should be correct.